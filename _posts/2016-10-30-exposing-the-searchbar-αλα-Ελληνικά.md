## 🇬🇷 Πως υλοποιείτε ένα transition αντίστοιχο του Dialer app



**tl;dr:** Μια σύντομη έκδοση αυτού του άρθρου με μόνο κώδικα μπορεί να βρεθεί στο παρακάτω [repository](https://github.com/alexstyl/Material-SearchTransition)


Λαμβάνω αρκετά μηνύματα από χρήστες της εφαρμογής μου λέγοντας μου ότι το feature που τους λείπει πιο πολύ είναι η _αναζήτηση_. Για μια εφαρμογή η οποία περιέχει πληροφορίες από διαφορετικές πηγές όπως εορτές επαφών, ονομαστικές εορτές και αργίες, όπως το Εορτολόγιο Memento, μπορώ να καταλάβω το γιατί. Το πρόβλημα είναι όμως πως το feature αυτό υπάρχει ήδη στην εφαρμογή. Ένα εικονίδιο αναζήτησης μπορεί να βρεθεί στο Toolbar και, αφού το εικονίδιο πατηθεί, η οθόνη αναζήτησης εμφανίζεται.

<img src="https://raw.githubusercontent.com/alexstyl/alexstyl.github.io/master/images/animating-the-toolbar/search_toolbar.png" alt="Ο χρήστης μπορεί να ξεκινήσει μια αναζήτηση πατώντας το εικονίδιο αναζήτησης στο Toolbar" style="width: 540;"/>

Στην προσπάθειά μου να βρω πιο ακριβώς είναι το πρόβλημα, αποφάσισα να μιλήσω με μερικούς από τους χρήστες μου. Μετά από μερικά emails και μερικές συνομιλίες με μερικούς τυχερούς κατέληξα στο εξής:

> Αρκετοί χρήστες έχουν συνηθίσει την αναζήτηση παρόμοια με το πως έχει γίνει σε ορισμένες γνωστές εφαρμογές όπως το Facebook, Swarm, και άλλες. Σε αυτές τις εφαρμογές, η μπάρα αναζήτησης μπορεί να χρησιμοποιηθεί απευθείας από το Toolbar, και ο χρήστης μπορεί να ξεκινήσει μια αναζήτηση από την αρχική οθόνη.

Καθώς η όλη λογική της αναζήτησης υπήρχε ήδη στην εφαρμογή, είχα την πολυτέλεια να χρησιμοποιήσω τα Animations API της πλατφόρμας και να δώσω μια νέα ζωντάνια στην εφαρμογή μου.

Η ιδέα ήταν να δημιουργήσω μια μετάβαση μεταξύ δυο οθονών μεταξύ τους: της αρχική οθόνης η οποία θα φιλοξενεί την μπάρα αναζήτησης (Search bar) και την οθόνη αναζήτησης στην οποία η αναζήτηση θα γίνεται πραγματικά

Από πλευράς design, ήθελα η μετάβαση να φαίνεται όσο πιο seamless μπορεί να γίνει, έτσι ώστε ο χρήστης να επικεντρωθεί στην αναζήτηση χωρίς να έχει την αίσθηση ότι άνοιξε μια νέα οθόνη. Από πλευράς development, όπως οι δύο οθόνες (Activities) έπρεπε να μείνουν ξεχωριστές. Κάθε Activity έχει τα δικά του responsibilities και αν έπρεπε για οποιονδήποτε λόγο να συνδυαστούν, η συντήρηση θα ήταν εφιάλτης.

Μιας και ήταν η πρώτη φορά που έπαιζα με Transitions, είχα διάβασμα να κάνω. Μια από τις πιο χρήσιμες πηγές που βρήκα στο να καταλάβω πως δουλεύουν τα νέα API ήταν το  [_Meaningful motion_ talk](https://skillsmatter.com/skillscasts/6798-meaningful-motion) του Nick Butcher και του Ben Weiss και οι διαφάνειες της παρουσίασης μου είναι χρήσιμες μέχρι και σήμερα.

Ένα παρόμοιο animation με αυτό που ήθελα να υλοποιήσω μπορεί να βρεθεί και στο [stock Android’s Phone app](https://play.google.com/store/apps/details?id=com.google.android.dialer). Με το που πατήσει ο χρήστης την μπάρα αναζήτησης, η κεντρική οθόνη εξαφανίζεται, η μπάρα αναζήτησης επεκτείνετε, και ο χρήστης είναι έτοιμος να ξεκινήσει την αναζήτηση.

![The transition as seen in the Dialer app](https://raw.githubusercontent.com/alexstyl/alexstyl.github.io/master/images/animating-the-toolbar/dialer.gif)

Δυστυχώς, η υλοποίηση στην συγκεκριμένη εφαρμογή δεν ήταν ακριβώς όπως την περίμενα. [Τα πάντα έχουν γίνει σε ένα τεράστιο activity](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android-apps/5.1.0_r1/com/android/dialer/DialtactsActivity.java). Κάτι τέτοιο θα μπορούσε να δουλέψει, αλλά δεν μου αρέσει να συνδυάζω τα διαφορετικά responsibilities μεταξύ τους, έτσι ώστε να θέλω στο μέλλον να αλλάξω το design της εφαρμογής να μπορώ να το κάνω πολύ πιο εύκολα. Παρόλο που η υλοποίηση δεν ήταν όπως την περίμενα, πήρα μια καλή ιδέα πως να προχωρήσω παρακάτω.

Έσπασα το transition που ήθελα σε τρία απλά βήματα:

1) εξαφάνισε τα περιεχόμενα του Toolbar

2) επέκτεινε το Toolbar

3) εμφάνισε και πάλι τα περιεχόμενα Toolbar

Είναι πολύ εύκολο να υλοποιηθεί κάτι τέτοιο με την χρήστη του `TransitionManager`. Καλώντας της μέθοδο  [`TransitionManager.beginDelayedTransition()`](https://developer.android.com/reference/android/transition/TransitionManager.html#beginDelayedTransition%28android.view.ViewGroup%29) και αλλάζοντας τα properties του View, το framework θα ξεκινήσει ένα animation αυτόματα για όλες τις αλλαγές που κάναμε στο View. Η ίδια μέθοδος μπορεί να χρησιμοποιηθεί και στην επέκταση του Toolbar αλλά και στην σμίκρυνση του. Η εξαφάνιση των περιεχομένων γίνεται με το ίδιο ακριβώς τρόπο, αλλά στην συγκεκριμένη περίπτωση πρέπει να αλλάξουμε το Visibility των Views. Το μόνο που μένει πλέον είναι να περάσουμε από το ένα Activiy στο άλλο κρύβοντας το συστημικό animation.

Ευτυχώς, θυμήθηκα πως είδα δει κάτι αντίστοιχο σε ένα από τα βίντεο του [Android Developers](https://www.youtube.com/user/androiddevelopers). Στο βίντεο με τίτλο [DevBytes: Custom Activity Animations](https://www.youtube.com/watch?v=CPxkoe2MraA) ο Chet Haase δείχνει πως μπορούμε να αντικαταστήσουμε το συστημικό animation όταν ξεκινάμε ή σταματάμε ένα activity. Τέλος, μπορούμε να βελτιώσουμε το transition κάνοντάς το να φαίνεται πιο γρήγορο, εμφανίζοντας το πληκτρολόγιο με το που ξεκινήσουμε την μετάβαση στην νέα οθόνη. Ένας εύκολος τρόπος για να το πετύχουμε αυτό είναι να χρησιμοποιήσουμε το κατάλληλο [windowSoftInputMode](https://developer.android.com/guide/topics/manifest/activity-element.html#wsoft) στο Manifest της εφαρμογής. Με αυτόν τον τρόπο το πληκτρολόγιο θα είναι ορατό όταν το activity ξεκινήσει.

Συνδυάζοντας όλα αυτά το τελικό αποτέλεσμα φαίνεται κάπως έτσι:

![The transition as seen in Memento Calendar](https://raw.githubusercontent.com/alexstyl/alexstyl.github.io/master/images/animating-the-toolbar/memento.gif)

Μπορεί να αναρωτιέστε αν η αλλαγή σε αυτό το design είχε κάποιο αποτέλεσμα. Είμαι αρκετά ευχαριστημένος με το αποτέλεσμα καθώς το update έφερε 30% παραπάνω αναζητήσεις στην εφαρμογή. Είτε ο κόσμος μπορεί πλέον πιο εύκολα να κάνει μια αναζήτηση ή τους αρέσει το animation 😄


---

Υπάρχουν διάφορες μικρές βελτιώσεις στο UX για ένα ακόμα καλύτερο αποτέλεσμα, όπως το να αλλάξουμε το χρώμα του Up ή να σταματήσουμε το activity όταν ο χρήστης πατήσει το κουμπί 'Πίσω' χωρίς να έχει ξεκινήσει μια αναζήτηση. Αν σας ενδιαφέρει το πως μπορεί να υλοποιηθεί κάτι τέτοιο το **Memento Calendar είναι open-source** και είσαστε ευπρόσδεκτοι να δείτε τι γίνεται στα παρασκήνια. Μπορείτε να κατεβάσετε τον κώδικα από στο [Github.com](https://github.com/alexstyl/Memento-Namedays) ή να **κατεβάσετε την εφαρμογή** από το [Google Play Store](https://play.google.com/store/apps/details?id=com.alexstyl.specialdates).
